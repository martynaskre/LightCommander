name: Build Application

on:
  push:
    branches:
      - master

permissions:
  contents: write

jobs:
  build:
    name: Build macOS App
    runs-on: macos-14
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
        
    - name: Build macOS Application
      id: build
      run: |
        xcodebuild \
          -project LightCommander.xcodeproj \
          -scheme LightCommander \
          -configuration Release
        
        echo "APPLICATION_PATH=$(xcodebuild -project LightCommander.xcodeproj -scheme LightCommander -configuration Release -showBuildSettings 2>/dev/null | awk '$1 == "BUILD_DIR" {print $3; exit}')" >> $GITHUB_OUTPUT

    - name: Create DMG
      run: |
        npm i -g create-dmg
        create-dmg ${{ steps.build.outputs.APPLICATION_PATH }}/Release/LightCommander.app --overwrite --dmg-title=LightCommander || true
        ls

    # - name: Upload Binary To Release
    #   uses: svenstaro/upload-release-action@v2
    #   with:
    #     repo_token: ${{ secrets.GITHUB_TOKEN }}
    #     file: LightCommander*.dmg
    #     asset_name: LightCommander.dmg
    #     tag: ${{ github.ref }}
    #     overwrite: true